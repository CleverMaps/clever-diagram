!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("ELK")):"function"==typeof define&&define.amd?define(["d3","ELK"],t):e.Diagram=t(e.d3,e.ELK)}(this,function(e,t){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,e),this._handlers=t.reduce(function(e,t){return e[t]=[],e},{})}return r(e,[{key:"on",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;return this._handlers[e].push(t),this}},{key:"off",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;if(t){var n=this._handlers[e],r=n.indexOf(t);-1!=r&&n.splice(r,1)}else this._handlers[e]=[];return this}},{key:"fire",value:function(e){if(!(e in this._handlers))throw"No such event: "+e;for(var t=this._handlers[e],n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i=0;i<t.length;i++)t[i].apply(this,r);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),e}(),i=function(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),n.appendChild(r),t}("._diagram_1pu3g_1 {\r\n    position: relative;\r\n}\r\n\r\n._node_1pu3g_9 {\r\n    position: absolute;\r\n    display: table;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    padding: 0px 10px;\r\n    table-layout: fixed;\r\n    word-break: break-all;\r\n    overflow:hidden;\r\n    box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);\r\n}\r\n\r\n._node-selected_1pu3g_33 {\r\n    outline:2px solid #546E7A;\r\n}\r\n\r\n._node-highlighted_1pu3g_41 {\r\n    background-color:#FFEB3B !important;\r\n}\r\n\r\n._node-highlighted_1pu3g_41>._node-text_1pu3g_49 {\r\n    background-color:#FFEB3B !important;\r\n    color:black;\r\n}\r\n\r\n._node-text_1pu3g_49 {\r\n    text-align: center;\r\n    display: table-cell;\r\n    color:white;\r\n    user-select: none;\r\n    vertical-align: middle;\r\n    font-family: 'Roboto';\r\n    font-size:13px;\r\n}\r\n\r\n._icon_1pu3g_79 {\r\n    color:white;\r\n    margin-right:7px;\r\n}",{diagram:"_diagram_1pu3g_1",node:"_node_1pu3g_9","node-selected":"_node-selected_1pu3g_33","node-highlighted":"_node-highlighted_1pu3g_41","node-text":"_node-text_1pu3g_49",icon:"_icon_1pu3g_79"});return function(){function s(e){if(n(this,s),this._observable=new o(["nodeClick","nodeHighlight"]),this._options=e||{},!e.elkWorkerUrl)throw"ELK worker URL has to be specified";this._elk=new t({workerUrl:e.elkWorkerUrl}),this._container=null,this._groupColors=e.groupColors||{}}return r(s,[{key:"on",value:function(e,t){return this._observable.on(e,t),this}},{key:"off",value:function(e,t){return this._observable.off(e,t),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._el.remove(),this._group.remove(),this}},{key:"render",value:function(t){this._container=e.select(t),this._svg=this._container.append("svg").style("position","absolute").attr("pointer-events","none"),this._group=this._svg.append("g"),this._group.append("svg:defs").append("svg:marker").attr("id","end").attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").style("fill","#546E7A").style("stroke-opacity",.6).append("svg:path").attr("d","M0,-5L10,0L0,5"),this._el=this._container.append("div").classed(i.diagram,!0)}},{key:"_getRootProperties",value:function(){return{algorithm:"layered",direction:"RIGHT"}}},{key:"_getElkGraph",value:function(){return{id:"root",properties:this._getRootProperties(),children:this._nodes.map(function(e){return{id:e.name,width:200,height:50}}),edges:this._edges.map(function(e,t){return{id:"edge_"+t,sources:[e.start],targets:[e.end]}})}}},{key:"_setGraphSize",value:function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y+e.height})),n=Math.max.apply(Math,e.map(function(e){return e.x+e.width}));this._el.style("width",n+"px"),this._el.style("height",t+"px"),this._svg.attr("width",n),this._svg.attr("height",t)}},{key:"_renderNodes",value:function(){var e=this,t=this._getElkGraph();return this._elk.layout(t).then(function(t){e._nodes.forEach(function(n,r){var o={top:t.children[r].y,left:t.children[r].x,width:t.children[r].width,height:t.children[r].height};e._renderNode(n,o)}),e._renderEdges(t),e._setGraphSize(t.children)})}},{key:"selectNode",value:function(t,n){var r=document.getElementById(t);if(!r)throw"Node "+t+" doesn't exist or graph hasn't been rendered yet";var o=e.select(r),s=i["node-selected"];n?(e.select("."+s).classed(s,!1),o.classed(s,!0),this._selectedNodeName=t):e.select("."+s).classed(s,!1)}},{key:"highlightNode",value:function(t,n){var r=e.select("#"+t),o=i["node-highlighted"];this._dragging&&e.event.relatedTarget&&"path"==e.event.relatedTarget.tagName||(n?(e.select("."+o).classed(o,!1),r.classed(o,!0),this._observable.fire("nodeHighlight",t,n)):(e.select("."+o).classed(o,!1),this._observable.fire("nodeHighlight",t,n)))}},{key:"_onMouseDown",value:function(e){this._dragging=!0,this._mouseDownBB=document.getElementById(e).getBoundingClientRect()}},{key:"_onMouseUp",value:function(e){var t=document.getElementById(e).getBoundingClientRect();this._mouseDownBB&&this._mouseDownBB.top==t.top&&this._mouseDownBB.left==t.left&&this._observable.fire("nodeClick",e),this._dragging=!1}},{key:"_renderNode",value:function(e,t){var n=this,r=this._groupColors[e.group]||"#2196F3",o=Object.keys(t).map(function(e){return e+":"+t[e]+"px"}).join(";")+"; background-color:"+r,s=this._el.append("div").attr("style",o).attr("class",i.node).attr("id",e.name).on("mousedown",function(){n._onMouseDown(e.name)}).on("mouseup",function(){n._onMouseUp(e.name)}).on("mouseover",function(){n.highlightNode(e.name,!0)}).on("mouseout",function(){n.highlightNode(e.name,!1)}),a=s.append("div").attr("class",i["node-text"]);a.append("i").attr("class","zmdi "+e.icon||"").classed(i.icon,!0),a.append("span").html(e.name)}},{key:"_getEdgeOverlay",value:function(e){return{arrow:[["PlainArrow",{location:1,width:10,length:10}]],link:[]}[e.type]}},{key:"_renderEdges",value:function(e){var t=this;this._edges.forEach(function(n,r){var o=t._group.append("path").attr("class","link").attr("stroke","#546E7A").attr("stroke-width",2).attr("fill","transparent").attr("d",function(){var t=e.edges[r].sections[0],n="";return t.startPoint&&t.endPoint&&(n+="M"+t.startPoint.x+" "+t.startPoint.y+" ",(t.bendPoints||[]).forEach(function(e){n+="L"+e.x+" "+e.y+" "}),n+="L"+t.endPoint.x+" "+t.endPoint.y+" "),n});"arrow"==n.type&&o.attr("marker-end","url(#end)")})}},{key:"setData",value:function(e){if(!this._container)throw"Diagram is not rendered";return this._el.html(""),this._nodes=e.nodes||[],this._edges=e.edges||[],this._renderNodes()}}]),s}()});
//# sourceMappingURL=can-diagram.min.js.map
