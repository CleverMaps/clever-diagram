!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("ELK")):"function"==typeof define&&define.amd?define(["d3","ELK"],t):e.CleverDiagram=t(e.d3,e.ELK)}(this,function(e,t){"use strict";var n=function(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t}("._diagram_jxxg2_1 {\r\n}\r\n\r\n._zoomable_jxxg2_7 {\r\n    overflow: visible;\r\n}\r\n\r\n._diagram-nodes_jxxg2_15 {\r\n\r\n}\r\n\r\n._diagram-node_jxxg2_15 {\r\n    cursor: pointer;\r\n}\r\n\r\n._node-icon_jxxg2_31 {\r\n    text-anchor: middle;\r\n    user-select: none;\r\n}\r\n\r\n._diagram-edges_jxxg2_41 {\r\n}\r\n\r\n._node-skeleton_jxxg2_47 {\r\n\r\n}\r\n\r\n._node-name_jxxg2_55 {\r\n    font-family: Roboto, sans-serif;\r\n    font-weight: 600;\r\n    user-select: none;\r\n}\r\n",{diagram:"_diagram_jxxg2_1",zoomable:"_zoomable_jxxg2_7","diagram-nodes":"_diagram-nodes_jxxg2_15","diagram-node":"_diagram-node_jxxg2_15","node-icon":"_node-icon_jxxg2_31","diagram-edges":"_diagram-edges_jxxg2_41","node-skeleton":"_node-skeleton_jxxg2_47","node-name":"_node-name_jxxg2_55"}),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];i(this,e),this._handlers=t.reduce(function(e,t){return e[t]=[],e},{})}return r(e,[{key:"on",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;return this._handlers[e].push(t),this}},{key:"off",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;if(t){var n=this._handlers[e],i=n.indexOf(t);-1!=i&&n.splice(i,1)}else this._handlers[e]=[];return this}},{key:"add",value:function(e){return e in this._handlers||(this._handlers[e]=[]),this}},{key:"fire",value:function(e){if(!(e in this._handlers))throw"No such event: "+e;for(var t=this._handlers[e],n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0;o<t.length;o++)t[o].apply(this,i);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),e}(),d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"component";i(this,t),this._container=null,this._className=e,this._observable=new a(["enter","leave","click"]),this._svg=null}return r(t,[{key:"on",value:function(e,t){return this._observable.on(e,t),this}},{key:"off",value:function(e,t){return this._observable.off(e,t),this}},{key:"_renderContainer",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.select(t).append("g").attr("class",n[this.className]).attr("transform","translate("+i+", "+r+")")}},{key:"render",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.destroy(),this._container=this._renderContainer(e,t,i),!this._container)throw"Component "+this._className+" was not rendered. Check your selector: "+e;return this._container.datum(r),this._container.on("click",function(e){n._observable.fire("click",e)}).on("mouseenter",function(e){n._observable.fire("enter",e)}).on("mouseleave",function(e){n._observable.fire("leave",e)}),this}},{key:"destroy",value:function(){return this.isRendered()&&(this.clearData(),this._container.datum(null),this._container.remove(),this._container=null),this}},{key:"clearData",value:function(){if(!this.isRendered())throw"Can't call clearData() when widget is not rendered, please call .render() first.";return this._clearData(),this._data=null,this}},{key:"isRendered",value:function(){return null!==this._container}},{key:"setData",value:function(e){if(!this.isRendered())throw"Can't call setData() when component is not rendered, please call .render() first.";return this._setData(this._container,e)}},{key:"className",get:function(){return this._className}},{key:"container",get:function(){return this._container}},{key:"observable",get:function(){return this._observable}}]),t}(),l=40,u=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"diagram-edge"))}return o(t,e),r(t,[{key:"_setData",value:function(e,t){e.selectAll("*").remove(),this._selected=t.selected,this._muted=t.muted,this._renderEdge(t)}},{key:"_renderEdge",value:function(e){var t=this,n=this._muted?"url(#end-muted)":"url(#end)",i=this._muted?"#bababa":"#4a4a4a";this._edge=this.container.append("path").attr("class","link").attr("stroke",i).attr("stroke-width",1).attr("stroke-linejoin","bevel").attr("fill","transparent").attr("d",function(){var n=e.layout.sections[0],i="";if(n.startPoint&&n.endPoint){i+="M"+n.startPoint.x+" "+n.startPoint.y+" ";var r={x:n.startPoint.x,y:n.startPoint.y};(n.bendPoints||[]).forEach(function(e,o){var s=n.bendPoints[o+1]||n.endPoint,a=t._getSectionParams(e,r,s,6),d=t._getSection(a);i+=d,r.x=e.x,r.y=e.y},t);var o={},s=t._getSectionParams(n.endPoint,r,o,6,!0),a=t._getSection(s);i+=a}return i}),"arrow"==e.edge.type&&this._edge.attr("marker-end",n)}},{key:"_getSection",value:function(e){var t=e.x,n=e.y,i=e.defaultRadius,r=e.isEnd,o="",s="",a=i,d={lastX:t.rounded-t.lastRounded,lastY:n.rounded-n.lastRounded,nextX:t.nextRounded-t.rounded,nextY:n.nextRounded-n.rounded};Object.keys(d).forEach(function(e){var t=Math.abs(d[e]);t&&t<a&&(a=t/2)});var l=r?0:a;return d.lastX>0?s="L "+(t.current-l)+" "+n.current+" ":d.lastX<0?s="L "+(t.current+l)+" "+n.current+" ":d.lastY>0?s="L "+t.current+" "+(n.current-l)+" ":d.lastY<0&&(s="L "+t.current+" "+(n.current+l)+" "),r||(d.nextY>0?o="Q "+t.current+" "+n.current+" "+t.current+" "+(n.current+a)+" ":d.nextY<0?o="Q "+t.current+" "+n.current+" "+t.current+" "+(n.current-a)+" ":d.nextX<0?o="Q "+t.current+" "+n.current+" "+(t.current-a)+" "+n.current+" ":d.nextX>0&&(o="Q "+t.current+" "+n.current+" "+(t.current+a)+" "+n.current+" ")),s.concat(o)}},{key:"_getSectionParams",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return{x:{current:e.x,last:t.x,next:n.x,rounded:Math.round(e.x),lastRounded:Math.round(t.x),nextRounded:Math.round(n.x)},y:{current:e.y,last:t.y,next:n.y,rounded:Math.round(e.y),lastRounded:Math.round(t.y),nextRounded:Math.round(n.y)},defaultRadius:i,isEnd:r}}},{key:"setSelected",value:function(e){this._selected=e}},{key:"setMuted",value:function(e){this._muted=e}},{key:"setStyle",value:function(){this._muted?(this._edge.attr("stroke","#bababa"),this._edge.attr("marker-end","url(#end-muted)")):(this._edge.attr("stroke","#4a4a4a"),this._edge.attr("marker-end","url(#end)"))}}]),t}(d),h=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"diagram-edges"))}return o(t,e),r(t,[{key:"_setData",value:function(e,t){var n=this;e.selectAll("*").remove(),this._renderDefs("end","#4a4a4a"),this._renderDefs("end-muted","#bababa"),this._createEdges(t),this._renderEdges(),this._data=t,this._subsequentNodes=t.subsequentNodes,this._selected=t.selected,t.edges.forEach(function(e,t){return n._setEdgeData(e,t)})}},{key:"_createEdges",value:function(e){this._edges=e.edges.map(function(){return new u})}},{key:"_renderEdges",value:function(){var e=this;this._edges.forEach(function(t,n){t.render(e.container.node(),0,0,n)})}},{key:"_setEdgeData",value:function(e,t){var n=this._data.layout.edges[t],i=this._selected===e.start,r=!1;this._selected&&(r=this._isSubsequentNode(this._selected,e.start));var o=this._selected&&!(i||r);this._edges[t].setData({edge:e,layout:n,selected:i,muted:o})}},{key:"_renderDefs",value:function(e,t){this.container.append("svg:defs").append("svg:marker").attr("id",e).attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").style("fill",t).style("stroke-opacity",.6).append("svg:path").attr("d","M0,-5L10,0L0,5")}},{key:"selectEdges",value:function(e){var t=this;this._data.edges.forEach(function(n,i){var r=t._edges[i],o=t._isSubsequentNode(e,n.start),s=e===n.start||o;r.setSelected(s),r.setMuted(!s),r.setStyle()})}},{key:"deselectEdges",value:function(e){var t=this;this._data.edges.forEach(function(n,i){var r=t._edges[i],o=e&&r._muted;r.setMuted(o),r.setSelected(!1),r.setStyle()})}},{key:"highlightEdges",value:function(e){var t=this;this._data.edges.forEach(function(n,i){var r=t._edges[i],o=t._isSubsequentNode(e,n.start),s=e===n.start||o;r.setMuted(!s),r.setStyle()})}},{key:"unhighlightEdges",value:function(e){var t=this;this._data.edges.forEach(function(n,i){var r=t._edges[i],o=e&&!r._selected;r.setMuted(o),r.setStyle()})}},{key:"_isSubsequentNode",value:function(e,t){return this._subsequentNodes[e].indexOf(t)>=0}}]),t}(d),c=function(e){function t(e){var n=e.nodeWidth,r=e.iconFontFamily;i(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"diagram-node"));return o._nodeWidth=n,o._iconFontFamily=r,o._observable.add("enterNode"),o}return o(t,e),r(t,[{key:"_setData",value:function(e,t){e.selectAll("*").remove(),this._node=t.node,this._selected=t.selected,this._selectedMuted=t.selectedMuted,this._selectedSubsequent=t.selectedSubsequent,this._styles=t.styles,this._groupColor=t.groupColor,this._renderAll()}},{key:"_renderAll",value:function(){this._renderGradients(),this._renderNodeBaseLayer(),this._renderNodeSkeleton(),this._node.icon&&this._renderIcon(),this._renderLine(),this._setNodeStyle(),this._rendertNodeName()}},{key:"_renderGradients",value:function(){this._gradientEdge=40/this._nodeWidth,this._defs=this.container.append("svg:defs"),this._renderDefaultGradient(),this._renderMutedGradient()}},{key:"_renderDefaultGradient",value:function(){this._defaultGradient=this._defs.append("svg:linearGradient").attr("id","node-background-default-"+this._node.name),this._defaultGradient.selectAll("stop").data([{offset:"0",color:this._groupColor,opacity:"0.4"},{offset:this._gradientEdge,color:this._groupColor,opacity:"0.4"},{offset:this._gradientEdge+.001,color:"rgba(255,255,255,1)",opacity:"1"},{offset:"1",color:"rgba(255,255,255,1)",opacity:"1"}]).enter().append("stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}).attr("stop-opacity",function(e){return e.opacity})}},{key:"_renderMutedGradient",value:function(){this._mutedGradient=this._defs.append("svg:linearGradient").attr("id","node-background-muted"),this._mutedGradient.selectAll("stop").data([{offset:"0",color:"#d5d5d5",opacity:"1"},{offset:this._gradientEdge,color:"#d5d5d5",opacity:"1"},{offset:this._gradientEdge+.001,color:"#f0f0f0",opacity:"1"},{offset:"1",color:"#f0f0f0",opacity:"1"}]).enter().append("stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}).attr("stop-opacity",function(e){return e.opacity})}},{key:"_renderNodeBaseLayer",value:function(){this._nodeBaseLayer=this.container.append("rect").attr("x",0).attr("y",0).attr("width",this._styles.width).attr("height",this._styles.height).attr("fill","white").attr("rx",5)}},{key:"_renderNodeSkeleton",value:function(){this._nodeSkeleton=this.container.append("rect").attr("x",0).attr("y",0).attr("width",this._styles.width).attr("height",this._styles.height).attr("fill","url(#node-background-default-"+this._node.name+")").attr("rx",5).attr("stroke","#4a4a4a").attr("stroke-width",1).attr("class",n["node-skeleton"]).attr("id",this._node.name)}},{key:"_renderIcon",value:function(){this._icon=this.container.append("text").attr("x",20).attr("y",this._styles.height/2+9-1).attr("class",n["node-icon"]).attr("font-family",this._iconFontFamily).attr("font-size",18).attr("fill","#4a4a4a").text(this._node.icon)}},{key:"_renderLine",value:function(){this._line=this.container.append("line").attr("x1",40).attr("y1",0).attr("x2",40).attr("y2",40).attr("stroke","#4a4a4a").attr("stroke-width",1).attr("opacity",0)}},{key:"_setNodeStyle",value:function(){this._selected?this._setSpecialStyle("#f8e71c",1):this._highlighted?this._setSpecialStyle(this._groupColor,.4):this._highlightedSubsequent||!this._selectedMuted&&!this._highlightedMuted?this._setOriginalStyle():this._setMutedStyle()}},{key:"_rendertNodeName",value:function(){this._clipPath=this._defs.append("clipPath").attr("id","node-name-mask"),this._nodeNameMask=this._clipPath.append("rect").attr("x",55).attr("y",0).attr("width",this._nodeWidth-40-25).attr("height",this._styles.height),this._nodeName=this.container.append("g").attr("clip-path","url(#node-name-mask)").append("text").text(this._node.name).attr("x",55).attr("y",l/2+6.5-2).attr("font-size",13).attr("fill","#4a4a4a").attr("class",n["node-name"])}},{key:"setStyle",value:function(){this._setNodeStyle()}},{key:"isSelected",value:function(){return this._selected}},{key:"isSelectedSubsequent",value:function(){return this._selectedSubsequent}},{key:"isHighlighted",value:function(){return this._highlighted}},{key:"setSelected",value:function(e){this._selected=e}},{key:"setSelectedSubsequent",value:function(e){this._selectedSubsequent=e}},{key:"setHighlighted",value:function(e){this._highlighted=e}},{key:"setHighlightedSubsequent",value:function(e){this._highlightedSubsequent=e}},{key:"setSelectedMuted",value:function(e){this._selectedMuted=e}},{key:"setHighlightedMuted",value:function(e){this._highlightedMuted=e}},{key:"_setSpecialStyle",value:function(e,t){this._nodeSkeleton.attr("fill",e).attr("fill-opacity",t).attr("stroke","#4a4a4a"),this._line.attr("opacity","1")}},{key:"_setMutedStyle",value:function(){this._nodeSkeleton.attr("fill","url(#node-background-muted").attr("fill-opacity","1").attr("stroke","#bababa"),this._line.attr("opacity","0")}},{key:"_setOriginalStyle",value:function(){this._nodeSkeleton.attr("fill","url(#node-background-default-"+this._node.name+")").attr("fill-opacity","1").attr("stroke","#4a4a4a"),this._line.attr("opacity","0")}}]),t}(d),_=function(e){function t(e){var n=e.nodeWidth,r=e.iconFontFamily,o=e.mouseControl;i(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"diagram-nodes"));return a._nodeWidth=n,a._iconFontFamily=r,a._mouseControl=o,a._observable.add("selectNode").add("deselectNode").add("highlightNode").add("unhighlightNode"),a}return o(t,e),r(t,[{key:"_setData",value:function(e,t){var n=this;e.selectAll("*").remove(),this._dataNodes=t.nodes,this._dataEdges=t.edges,this._layout=t.layout,this._groupColors=t.groupColors,this._selected=t.selected,this._subsequentNodes=t.subsequentNodes,this._createNodes(t),this._renderNodes(),t.nodes.forEach(function(e,t){return n._setNodeData(e,t)})}},{key:"_createNodes",value:function(e){var t=this;this._nodes=e.nodes.map(function(){return new c({nodeWidth:t._nodeWidth,iconFontFamily:t._iconFontFamily})})}},{key:"_renderNodes",value:function(){var e=this;this._nodes.forEach(function(t,n){var i=e._dataNodes[n].name,r=e._getStyles(e._layout.children[n]);t.render(e.container.node(),r.x,r.y,n),e._mouseControl&&t.on("click",function(t){e._nodes[t].isSelected()?e._observable.fire("deselectNode",i):e._observable.fire("selectNode",i)}).on("enter",function(){e._enterTimeout=setTimeout(function(){e._observable.fire("highlightNode",i)},150)}).on("leave",function(){clearTimeout(e._enterTimeout),e._observable.fire("unhighlightNode")})})}},{key:"selectNode",value:function(e){var t=this,n=this._subsequentNodes[e];this._dataNodes.forEach(function(i,r){var o=t._nodes[r],s=n.indexOf(i.name)>=0,a=e===i.name,d=!(a||s);o.setSelected(a),o.setSelectedSubsequent(s),o.setSelectedMuted(d),o.setStyle()})}},{key:"deselectNode",value:function(){var e=this;this._dataNodes.forEach(function(t,n){var i=e._nodes[n];i.setSelected(!1),i.setSelectedMuted(!1),i.setStyle()})}},{key:"highlightNode",value:function(e){var t=this,n=this._subsequentNodes[e];this._dataNodes.forEach(function(i,r){var o=t._nodes[r],s=e===i.name,a=n.indexOf(i.name)>=0,d=!(s||a);o.setHighlighted(s),o.setHighlightedSubsequent(a),o.setHighlightedMuted(d),o.setStyle()})}},{key:"unhighlightNode",value:function(){this._nodes.forEach(function(e){e.setHighlighted(!1),e.setHighlightedSubsequent(!1),e.setHighlightedMuted(!1),e.setStyle()})}},{key:"_setNodeData",value:function(e,t){var n=this._getStyles(this._layout.children[t]),i=this._groupColors[e.group]||"#2196F3",r=this._selected===e.name,o=void 0,s=!1;if(this._selected){var a=this._subsequentNodes[this._selected],d=a&&a.indexOf(e.name)>=0;o=!d,s=d}this._nodes[t].setData({node:e,selected:r,selectedSubsequent:s,selectedMuted:o,styles:n,groupColor:i})}},{key:"_getStyles",value:function(e){return{y:e.y,x:e.x,width:e.width,height:e.height}}},{key:"isSomeSelected",value:function(){return this._nodes.some(function(e){return e.isSelected()})}},{key:"isSomeHighlighted",value:function(){return this._nodes.some(function(e){return e.isHighlighted()})}}]),t}(d);return function(a){function d(e){var n=e.nodeWidth,r=void 0===n?190:n,o=e.nodeHeight,a=void 0===o?l:o,u=e.groupColors,h=void 0===u?{}:u,c=e.elkWorkerUrl,_=e.mouseControl,f=void 0===_||_,g=e.iconFontFamily,v=e.zoomable,y=void 0===v||v,m=e.diagramMargin,p=void 0===m?50:m;i(this,d);var k=s(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,"diagram"));return k._nodeWidth=r,k._nodeHeight=a,k._groupColors=h,k._elkWorkerUrl=c,k._mouseControl=f,k._iconFontFamily=g,k._zoomable=y,k._diagramMargin=p,k._hasRenderedNodes=!1,k._currentScale=1,k._transitionDuration=200,k._elk=new t({workerUrl:k._elkWorkerUrl}),k._observable.add("selectNode").add("deselectNode").add("highlightNode").add("unhighlightNode").add("zoom"),k}return o(d,a),r(d,[{key:"_renderContainer",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._svgContainer=e.select(t).append("svg"),this._svgContainer.append("g").attr("class",n[this.className]).attr("transform","translate("+i+", "+r+")")}},{key:"_setData",value:function(e,t){return e.selectAll("*").remove(),this._dataEdges=t.edges||[],this._dataNodes=t.nodes||[],this._data=t,this._renderElk()}},{key:"_renderElk",value:function(){var e=this,t=this._getElkGraph();return this._elk.layout(t).then(function(t){var n=e._getSubsequentNodes(e._data);e._renderEdges(t,n),e._renderNodes(t,n),e._graphSize=e._getGraphSize(t.children,t.edges),e._zoomable?(e._doZoom(),e._moveGraph()):e._setGraphSize(e._graphSize),e._hasRenderedNodes=!0})}},{key:"_getElkGraph",value:function(){var e=this;return{id:"root",properties:this._getRootProperties(),children:this._dataNodes.map(function(t){return{id:t.name,width:e._nodeWidth,height:e._nodeHeight}}),edges:this._dataEdges.map(function(e,t){return{id:"edge_"+t,sources:[e.start],targets:[e.end]}})}}},{key:"_getRootProperties",value:function(){return{algorithm:"layered",direction:"RIGHT"}}},{key:"_getSubsequentNodes",value:function(e){var t=this;return e.nodes.reduce(function(n,i){var r=t._findEdgesRecursive(e.edges,[i.name]);return n[i.name]=r.map(function(e){return e.end}),n},{})}},{key:"_findEdgesRecursive",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=t.reduce(function(t,i){if(n.indexOf(i)>=0)return t;var r=e.filter(function(e){return e.start===i});return t.concat(r)},[]),r=i.map(function(e){return e.end});return n=n.concat(t),r.length?i.concat(this._findEdgesRecursive(this._dataEdges,r,n)):i}},{key:"_getGraphSize",value:function(e,t){var n=t.flatMap(function(e){return e.sections.filter(function(e){return e.bendPoints})}),i=n.flatMap(function(e){return e.bendPoints.flatMap(function(e){return e.y})}),r=Math.max.apply(Math,i),o=Math.max.apply(Math,e.map(function(e){return e.y+e.height})),s=Math.max(r,o)+10;return{width:Math.max.apply(Math,e.map(function(e){return e.x+e.width}))+10,height:s}}},{key:"_setGraphSize",value:function(e){var t=e.width,n=e.height;this._svgContainer.style("width",t+"px"),this._svgContainer.style("height",n+"px")}},{key:"_moveGraph",value:function(){var t=this._getTranslatePosition(1),n=t.x,i=t.y;this._svgContainer.call(this._zoom.transform,e.zoomIdentity.translate(n,i))}},{key:"_getTranslatePosition",value:function(e){var t=this,n=function(e,n){return(t._svgSize[e]-t._graphSize[e]*n)/2},i=n("width",e),r=n("height",e);return{x:Math.max(i,this._diagramMargin),y:Math.max(r,this._diagramMargin)}}},{key:"_doZoom",value:function(){this._svgSize=this._svgContainer.node().getBoundingClientRect(),this._svgContainer.classed(n.zoomable,!0),this._zoomOutScaleWidth=this._getZoomOutScale(this._graphSize.width,this._svgSize.width-2*this._diagramMargin),this._zoomOutScaleHeight=this._getZoomOutScale(this._graphSize.height,this._svgSize.height-2*this._diagramMargin),this._zoomOutScale=Math.min(this._zoomOutScaleWidth,this._zoomOutScaleHeight),this._zoom=e.zoom().extent([[0,0],[this._svgSize.width,this._svgSize.height]]).scaleExtent([this._zoomOutScale,1]),this._zoom.on("zoom",this._zoomHandler.bind(this)),this._svgContainer.call(this._zoom)}},{key:"_getZoomOutScale",value:function(e,t){return e>t?t/e:1}},{key:"_zoomHandler",value:function(){this._currentScale=e.event.transform.k;var t=e.event.transform,n=t.x,i=t.y,r=t.k;this._observable.fire("zoom",{x:n,y:i,k:r})}},{key:"_renderEdges",value:function(e,t){var n={layout:e,edges:this._dataEdges,subsequentNodes:t,selected:this._data.selected};this._edges=new h,this._edges.render(this.container.node()),this._edges.setData(n)}},{key:"_renderNodes",value:function(e,t){var n=this,i={nodes:this._data.nodes,edges:this._data.edges,selected:this._data.selected,layout:e,groupColors:this._groupColors,subsequentNodes:t};this._nodes=new _({nodeWidth:this._nodeWidth,iconFontFamily:this._iconFontFamily,mouseControl:this._mouseControl}),this._nodes.render(this.container.node()).on("selectNode",function(e){n._observable.fire("selectNode",e)}).on("deselectNode",function(e,t){n._observable.fire("deselectNode",e,t)}).on("highlightNode",function(e){n._observable.fire("highlightNode",e)}).on("unhighlightNode",function(e){n._observable.fire("unhighlightNode",e)}),this._nodes.setData(i)}},{key:"hasRenderedNodes",value:function(){return this._hasRenderedNodes}},{key:"selectNode",value:function(e){this._nodes.selectNode(e),this._edges.selectEdges(e)}},{key:"deselectNode",value:function(e){var t=this._nodes.isSomeHighlighted();this._nodes.deselectNode(e),this._edges.deselectEdges(t)}},{key:"highlightNode",value:function(e){this._nodes.highlightNode(e),this._edges.highlightEdges(e)}},{key:"unhighlightNode",value:function(){var e=this._nodes.isSomeSelected();this._nodes.unhighlightNode(),this._edges.unhighlightEdges(e)}},{key:"setTransform",value:function(e){this._container.attr("transform","translate("+e.x+", "+e.y+"), scale("+e.k+")")}},{key:"setZoom",value:function(e){this._zoomable&&this._zoom.scaleTo(this._svgContainer.transition().duration(this._transitionDuration),e)}},{key:"setFullExtent",value:function(){if(this._zoomable){var t=this.getZoomFullExtentTransform(),n=t.x,i=t.y,r=t.k;this._svgContainer.transition().duration(this._transitionDuration).call(this._zoom.transform,e.zoomIdentity.translate(n,i).scale(r))}}},{key:"getZoomFullExtentTransform",value:function(){var e=this._getTranslatePosition(this._zoomOutScale);return{x:e.x,y:e.y,k:this._zoomOutScale}}},{key:"reloadZoom",value:function(){if(this._zoom){this._zoom.on("zoom",null);var e=this._currentScale;this._doZoom(),e<this._zoomOutScale&&this.setFullExtent()}}},{key:"_clearData",value:function(){this._zoom&&this._zoom.on("zoom",null),this._dataEdges=null,this._dataNodes=null,this._edges=null,this._nodes=null,this._elk=null}}]),d}(d)});
//# sourceMappingURL=clever-diagram-1.1.3.min.js.map
