!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("jsPlumb"),require("$klay")):"function"==typeof define&&define.amd?define(["d3","jsPlumb","$klay"],t):e.Diagram=t(e.d3,e.jsPlumb,e.$klay)}(this,function(e,t,n){"use strict";var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];r(this,e),this._handlers=t.reduce(function(e,t){return e[t]=[],e},{})}return i(e,[{key:"on",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;return this._handlers[e].push(t),this}},{key:"off",value:function(e,t){if(!(e in this._handlers))throw"No such event: "+e;if(t){var n=this._handlers[e],r=n.indexOf(t);-1!=r&&n.splice(r,1)}else this._handlers[e]=[];return this}},{key:"fire",value:function(e){if(!(e in this._handlers))throw"No such event: "+e;for(var t=this._handlers[e],n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<t.length;o++)t[o].apply(this,r);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),e}(),s=function(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),n.appendChild(r),t}("._diagram_6gib6_1 {\r\n    position: relative;\r\n}\r\n\r\n._node_6gib6_9 {\r\n    position: absolute;\r\n    display: table;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);\r\n}\r\n\r\n._node-selected_6gib6_25 {\r\n    border:2px solid #546E7A;\r\n}\r\n\r\n._node-highlighted_6gib6_33 {\r\n    background-color:#FFEB3B !important;\r\n}\r\n\r\n._node-highlighted_6gib6_33>._node-text_6gib6_41 {\r\n    background-color:#FFEB3B !important;\r\n    color:black;\r\n}\r\n\r\n._node-text_6gib6_41 {\r\n    text-align: center;\r\n    display: table-cell;\r\n    color:white;\r\n    text-transform: uppercase;\r\n    vertical-align: middle;\r\n    font-family: 'Roboto';\r\n    font-size:13px;\r\n}",{diagram:"_diagram_6gib6_1",node:"_node_6gib6_9","node-selected":"_node-selected_6gib6_25","node-highlighted":"_node-highlighted_6gib6_33","node-text":"_node-text_6gib6_41"});return function(){function a(e){r(this,a),this._observable=new o(["nodeSelected","nodeDeselected","nodeHighlight"]),this._options=e||{},this._container=null,this._groupColors=e.groupColors||{}}return i(a,[{key:"on",value:function(e,t){return this._observable.on(e,t),this}},{key:"off",value:function(e,t){return this._observable.off(e,t),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._plumb.clear(),this._el.remove(),this._group.remove(),this}},{key:"render",value:function(n){this._container=e.select(n),this._plumb=t.getInstance(),this._svg=this._container.append("svg").style("position","absolute").attr("pointer-events","none"),this._group=this._svg.append("g"),this._group.append("svg:defs").append("svg:marker").attr("id","end").attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").style("fill","#546E7A").style("stroke-opacity",.6).append("svg:path").attr("d","M0,-5L10,0L0,5"),this._el=this._container.append("div").classed(s.diagram,!0)}},{key:"_getKlayGraph",value:function(){return{id:"root",children:this._nodes.map(function(e){return{id:e.name,width:200,height:50}}),edges:this._edges.map(function(e,t){return{id:"edge_"+t,source:e.start,target:e.end}})}}},{key:"_setGraphSize",value:function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y+e.height})),n=Math.max.apply(Math,e.map(function(e){return e.x+e.width}));this._el.style("width",n+"px"),this._el.style("height",t+"px"),this._svg.attr("width",n),this._svg.attr("height",t)}},{key:"_renderNodes",value:function(){var e=this;return new Promise(function(t,r){n.layout({graph:e._getKlayGraph(),options:{spacing:40,algorithm:"de.cau.cs.kieler.klay.layered",layoutHierarchy:!0,intCoordinates:!0,direction:"RIGHT",mergeEdges:!1,layerConstraint:"LAST_SEPARATE",nodePlace:"BRANDES_KOEPF",nodeLayering:"NETWORK_SIMPLEX"},success:function(n){e._nodes.forEach(function(t,r){var i={top:n.children[r].y,left:n.children[r].x,width:n.children[r].width,height:n.children[r].height};e._renderNode(t,i)}),e._renderEdges(n),e._setGraphSize(n.children),t()},error:function(e){console.log(e),r()}})})}},{key:"selectNode",value:function(t){var n=document.getElementById(t);if(!n)throw"Node "+t+" doesn't exist or graph hasn't been rendered yet";var r=e.select(n),i=s["node-selected"];r.classed(i)?(e.select("."+i).classed(i,!1),this._observable.fire("nodeDeselected",t)):(e.select("."+i).classed(i,!1),r.classed(i,!0),this._observable.fire("nodeSelected",t),this._selectedNodeName&&t!=this._selectedNodeName&&this._observable.fire("nodeDeselected",this._selectedNodeName),this._selectedNodeName=t)}},{key:"highlightNode",value:function(t,n){var r=e.select("#"+t),i=s["node-highlighted"];this._dragging&&e.event.relatedTarget&&"path"==e.event.relatedTarget.tagName||(n?(e.select("."+i).classed(i,!1),r.classed(i,!0),this._observable.fire("nodeHighlight",t,n)):(e.select("."+i).classed(i,!1),this._observable.fire("nodeHighlight",t,n)))}},{key:"_onMouseDown",value:function(e){this._dragging=!0,this._mouseDownBB=document.getElementById(e).getBoundingClientRect()}},{key:"_onMouseUp",value:function(e){var t=document.getElementById(e).getBoundingClientRect();this._mouseDownBB&&this._mouseDownBB.top==t.top&&this._mouseDownBB.left==t.left&&this.selectNode(e),this._dragging=!1}},{key:"_renderNode",value:function(e,t){var n=this,r=this._groupColors[e.group]||"#2196F3",i=Object.keys(t).map(function(e){return e+":"+t[e]+"px"}).join(";")+"; background-color:"+r;this._el.append("div").attr("style",i).attr("class",s.node).attr("id",e.name).on("mousedown",function(){n._onMouseDown(e.name)}).on("mouseup",function(){n._onMouseUp(e.name)}).on("mouseover",function(){n.highlightNode(e.name,!0)}).on("mouseout",function(){n.highlightNode(e.name,!1)}).append("div").attr("class",s["node-text"]).html(e.name)}},{key:"_getEdgeOverlay",value:function(e){return{arrow:[["PlainArrow",{location:1,width:10,length:10}]],link:[]}[e.type]}},{key:"_renderEdges",value:function(e){this._options.editable?this._renderEdgesEditable():this._renderEdgesStatic(e)}},{key:"_renderEdgesEditable",value:function(){var e=this;this._edges.forEach(function(t){var n=e._getEdgeOverlay(t);e._plumb.connect({source:t.start,target:t.end,anchor:["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],endpoint:"Blank",paintStyle:{stroke:"#546E7A",strokeWidth:2},connector:"Straight",overlays:n,endpointStyle:{fill:"black"}})}),this._plumb.draggable(document.querySelectorAll("."+s.node))}},{key:"_renderEdgesStatic",value:function(e){var t=this;this._edges.forEach(function(n,r){var i=t._group.append("path").attr("class","link").attr("stroke","#546E7A").attr("stroke-width",2).attr("fill","transparent").attr("d",function(){var t=e.edges[r],n="";return t.sourcePoint&&t.targetPoint&&(n+="M"+t.sourcePoint.x+" "+t.sourcePoint.y+" ",(t.bendPoints||[]).forEach(function(e,t){n+="L"+e.x+" "+e.y+" "}),n+="L"+t.targetPoint.x+" "+t.targetPoint.y+" "),n});"arrow"==n.type&&i.attr("marker-end","url(#end)")})}},{key:"setData",value:function(e){if(!this._container)throw"Diagram is not rendered";return this._el.html(""),this._nodes=e.nodes||[],this._edges=e.edges||[],this._renderNodes()}}]),a}()});
//# sourceMappingURL=diagram.min.js.map
